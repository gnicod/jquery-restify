!function(a){function b(b,d){this.options=a.extend({},c,d),this.form=b,this.json={},this._defaults=c,this._name="restify",this.init()}var c={root:"",with_root:!0,fields:{},excluded:[],append:[],url:"",type:"",contentType:"application/json",mimeType:"application/json",callback:function(a,b){}};b.prototype={init:function(){var b=this,c=this.form.find("input:submit");void 0!==this.options.btn&&(c=a("#"+this.options.btn)),c.on("click",function(a){return b.form.find(".restify-msg").hide(),b.form.find(".restify-wrap").removeClass("restify-err"),b.parseForm(this.form,this.options),a.preventDefault(),!1}),this.setFormDefault("root","name","root"),this.setFormDefault("url","action","/"),this.setFormDefault("type","method","PUT")},setFormDefault:function(a,b,c){""===this.options[a]&&""!==this.form.attr(b)&&void 0!==this.form.attr(b)?this.options[a]=this.form.attr(b):this.options[a]=c},parseForm:function(){var b={},c=this;a(this.form).find("input[type='text'],select,input[type='hidden'],input[type='password'],input[type='radio']:checked,textarea").each(function(){a.inArray(this.name,c.options.excluded)<0&&(b[this.name]=a(this).val())}),a(this.form).find("input[type='checkbox']").each(function(){if("[]"===this.name.substr(this.name.length-2)){var d=this.name.substr(0,this.name.length-2);void 0===b[d]&&(b[d]=[])}if(a.inArray(this.name,c.options.excluded)<0)if("[]"===this.name.substr(this.name.length-2)){if(a(this).is(":checked")){var d=this.name.substr(0,this.name.length-2);b[d].push(a(this).val())}}else b[this.name]=a(this).is(":checked")}),this.options.with_root?this.json[this.options.root]=b:this.json=b;for(var b in this.options.append)this.options.with_root?this.json[this.options.root][b]=this.options.append[b]:this.json[b]=this.options.append[b];this.preprocess()},preprocess:function(){if(void 0!==this.options.preprocess)for(var a in this.options.preprocess){var b=this.options.preprocess[a];this.json[this.options.root][a]=b(this.json[this.options.root][a])}this.send(JSON.stringify(this.json))},send:function(b){if(!this.isValid())return!1;var c=this;this.options.type;a.ajax({url:c.options.url,type:c.options.type,data:b,mimeType:c.options.mimeType,contentType:c.options.contentType,dataType:"json"}).always(function(a){c.options.callback(a,b)})},isValid:function(){var b=!1;for(var c in this.options.fields){var d=a(c);if(this.checkLenght(d,this.options.fields[c]["min-length"],this.options.fields[c]["max-length"])||(b=!0),void 0!==this.options.fields[c].custom&&void 0!==this.options.fields[c].custom.fn){var e=window[this.options.fields[c].custom.fn]||function(a){return!0};e(d)||(this.setErrorMessage(d,this.options.fields[c].custom.message),b=!0)}if(void 0!==this.options.fields[c].regexp&&void 0!==this.options.fields[c].regexp.pattern){var f=new RegExp(this.options.fields[c].regexp.pattern);f.test(d.val())||(this.setErrorMessage(d,this.options.fields[c].regexp.message),b=!0)}}return!b},checkLenght:function(a,b,c){var d=!0,e=!0;return void 0!==b&&a.val().length<b&&(d=!1,this.setErrorMessage(a,"min length "+b)),void 0!==c&&a.val().length>c&&(e=!1,this.setErrorMessage(a,"max length "+c)),d&&e},setErrorMessage:function(a,b){a.parent().hasClass("restify-wrap")?(a.parent().addClass("restify-err"),a.parent().find(".restify-msg").text(b).show()):(a.wrapAll('<span class="restify-wrap restify-err" />'),a.parent().append('<span class="restify-msg">'+b+"</span>")),a.focus()}},a.fn.restify=function(c){var d=null;return this.each(function(){d=new b(a(this),c)}),d}}(window.jQuery);